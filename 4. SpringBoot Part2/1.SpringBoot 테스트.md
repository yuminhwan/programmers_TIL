## ì†Œí”„íŠ¸ì›¨ì–´ í…ŒìŠ¤íŒ… 

> **ì†Œí”„íŠ¸ì›¨ì–´ í…ŒìŠ¤íŠ¸**ëŠ” ì£¼ìš” ì´í•´ê´€ê³„ìë“¤ì—ê²Œ ì‹œí—˜ ëŒ€ìƒ ì œí’ˆ ë˜ëŠ” ì„œë¹„ìŠ¤ì˜ í’ˆì§ˆì— ê´€í•œ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ì¡°ì‚¬ ê³¼ì •ì´ë‹¤. ì†Œí”„íŠ¸ì›¨ì–´ í…ŒìŠ¤íŠ¸ëŠ” ë˜í•œ ì†Œí”„íŠ¸ì›¨ì–´ì— ëŒ€í•œ ê°ê´€ì ì´ê³  ë…ë¦½ì ì¸ ì‹œê°ì„ ì œê³µí•˜ì—¬ ì‚¬ì—…ì£¼ì²´ê°€ ì†Œí”„íŠ¸ì›¨ì–´ êµ¬í˜„ì˜ ìœ„í—˜ì„±ì„ ì˜¬ë°”ë¡œ ì´í•´í•˜ë„ë¡ í•œë‹¤. ì‹œí—˜ ê¸°ìˆ ì—ëŠ” í”„ë¡œê·¸ë¨ì´ë‚˜ ì‘ìš© í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ì—¬ ì†Œí”„íŠ¸ì›¨ì–´ ë²„ê·¸ë¥¼ ì°¾ëŠ” ì ˆì°¨ë¥¼ í¬í•¨ë˜ë‚˜ ì´ì— êµ­í•œë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.
>
> [ì¶œì²˜](https://ko.wikipedia.org/wiki/ì†Œí”„íŠ¸ì›¨ì–´_í…ŒìŠ¤íŠ¸)



## í…ŒìŠ¤íŠ¸ ë ˆë²¨ 

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Unit Test)

> ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ê°€ì¥ ì‘ì€ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ì˜ˆìƒëŒ€ë¡œ ë™ì‘í•˜ëŠ” ì§€ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ì´ë‹¤.

ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì—ì„œ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ë‹¨ìœ„ì˜ í¬ê¸°ëŠ” ì£¼ë¡œ í´ë˜ìŠ¤ ë˜ëŠ” ë©”ì„œë“œ ìˆ˜ì¤€ìœ¼ë¡œ ì •í•´ì§„ë‹¤. 

ë‹¨ìœ„ì˜ í¬ê¸°ê°€ ì‘ì„ìˆ˜ë¡ ë‹¨ìœ„ì˜ ë³µì¡ì„±ì´ ë‚®ì•„ì§€ë¯€ë¡œ ë™ì‘ì„ í‘œí˜„í•˜ê¸° ë” ì‰¬ì›Œì§„ë‹¤. ì¦‰, í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ë‹¨ìœ„ì˜ í¬ê¸°ë¥¼ ì‘ê²Œ ì„¤ì •í•´ì„œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ìµœëŒ€í•œ ê°„ë‹¨í•˜ê³  ë””ë²„ê¹…í•˜ê¸° ì‰½ê²Œ ì‘ì„±í•´ì•¼ í•œë‹¤.

JavaëŠ” ì£¼ë¡œ `JUnit`ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•œë‹¤.



### í†µí•© í…ŒìŠ¤íŠ¸ (Integration Test)

> í†µí•© í…ŒìŠ¤íŠ¸ëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë³´ë‹¤ ë” í° ë™ì‘ì„ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ëª¨ë“ˆë“¤ì„ ëª¨ì•„ ì´ë“¤ì´ ì˜ë„ëŒ€ë¡œ í˜‘ë ¥í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ì´ë‹¤.

í†µí•© í…ŒìŠ¤íŠ¸ëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì™€ ë‹¬ë¦¬ ê°œë°œìê°€ ë³€ê²½í•  ìˆ˜ ì—†ëŠ” ë¶€ë¶„(ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬)ê¹Œì§€ ë¬¶ì–´ ê²€ì¦í•  ë•Œ ì‚¬ìš©í•œë‹¤. 

ì´ëŠ” DBì— ì ‘ê·¼í•˜ê±°ë‚˜ ì „ì²´ ì½”ë“œì™€ ë‹¤ì–‘í•œ í™˜ê²½ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ”ë° í•„ìš”í•œ ëª¨ë“  ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ, í†µí•© í…ŒìŠ¤íŠ¸ê°€ ì‘ìš© í”„ë¡œê·¸ë¨ì´ ì™„ì „í•˜ê²Œ ì‘ë™í•˜ëŠ”ê±¸ ë¬´ì¡°ê±´ ì¦ëª…í•˜ì§€ ì•ŠëŠ”ë‹¤. 

í†µí•© í…ŒìŠ¤íŠ¸ëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì—ì„œ ë°œê²¬í•˜ê¸° ì–´ë ¤ìš´ ë²„ê·¸ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆì§€ë§Œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë³´ë‹¤ ë” ë§ì€ ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ë•Œë¬¸ì— ì‹ ë¢°ì„±ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆê³  ì–´ë””ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸í•˜ê¸°  ì‰½ì§€ ì•Šì•„ ìœ ì§€ë³´ìˆ˜í•˜ê¸° í˜ë“¤ë‹¤ëŠ” ë‹¨ì ì´ ì¡´ì¬í•œë‹¤.

ìŠ¤í”„ë§ë¶€íŠ¸ì—ì„œëŠ” `@SpringBootTest`ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.



### ì „ êµ¬ê°„ í…ŒìŠ¤íŠ¸ (End-to-End Test)

> í•´ë‹¹ ì‹œìŠ¤í…œê³¼ í•´ë‹¹ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ê³  ë°°í¬í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ëª¨ë‘ ì‹œí—˜í•˜ëŠ” í…ŒìŠ¤íŠ¸ì´ë‹¤.

ë‚´ë¶€ ê¸°ëŠ¥ë“¤ê¹Œì§€ í…ŒìŠ¤íŠ¸ í•  í•„ìš”ëŠ” ì—†ë‹¤. ì´ëŠ” ë‹¨ìœ„í…ŒìŠ¤íŠ¸ì˜ ì˜ì—­ì´ê¸° ë•Œë¬¸ì´ë‹¤. 

ë‹¨ì ì€ í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê¸°ê°€ í˜ë“¤ê³ , ë§Œë“  í…ŒìŠ¤íŠ¸ë¥¼ ì‹ ë¢°í•˜ê¸°ë„ í˜ë“¤ë‹¤.



### ì¸ìˆ˜ í…ŒìŠ¤íŠ¸(Acceptance Test)

> ì¸ìˆ˜ í…ŒìŠ¤íŠ¸ëŠ” ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ì— ë§ì¶° ìˆ˜í–‰í•˜ëŠ” í…ŒìŠ¤íŠ¸ì´ë‹¤.

ì•ì„  í…ŒìŠ¤íŠ¸ë“¤ê³¼ ë‹¬ë¦¬ ë¹„ì¦ˆë‹ˆìŠ¤ ìª½ì— ì´ˆì ì„ ë‘”ë‹¤. 

ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ìš”êµ¬í•˜ëŠ” ê²ƒì€ `ëˆ„ê°€, ì–´ë–¤ ëª©ì ìœ¼ë¡œ, ë¬´ì—‡ì„ í•˜ëŠ”ê°€`ì´ê¸° ë•Œë¬¸ì— ì¸ìˆ˜ í…ŒìŠ¤íŠ¸ëŠ” ì£¼ë¡œ APIë¥¼ í™•ì¸í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì´ë¤„ì§„ë‹¤. 

ì¦‰, ì¸ìˆ˜ í…ŒìŠ¤íŠ¸ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ì¸ìˆ˜ë¥¼ ëª©ì ìœ¼ë¡œ í•˜ëŠ” í…ŒìŠ¤íŠ¸ì´ë‹¤. ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì¸ìˆ˜í•˜ê¸° ì „ì— ëª…ì„¸í•œ ìš”êµ¬ì‚¬í•­ëŒ€ë¡œ ì˜ ì‘ë™í•˜ëŠ” ì§€ì— ëŒ€í•œ ê²€ì¦ì„ í•˜ëŠ” ê²ƒì´ë‹¤.

ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì‹¤ì œ ì‚¬ìš©ì ê´€ì ì—ì„œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²½ìš°ê°€ ë§ìœ¼ë©° ì£¼ë¡œ E2E(End-to-End)í˜•ì‹ì„ ì´ìš©í•´ì„œ í™•ì¸í•œë‹¤.

Javaì—ì„œëŠ” `RestAssured` ,` MockMvc` ê°™ì€ ë„êµ¬ë¥¼ í™œìš©í•˜ì—¬ ì‘ì„±í•œë‹¤.



## ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë€?

- ê°€ì¥ ì‘ì€ ë‹¨ìœ„ë¡œ í…ŒìŠ¤íŠ¸ 
	- ë‹¨ìœ„ì˜ ê²½ìš° í´ë˜ìŠ¤ë‚˜ ë©”ì„œë“œ 
- ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ë©° ì‹¤í–‰ ì‹œê°„ì´ ë¹ ë¥´ë‹¤. 

- ì˜¤ë¥˜ë¥¼ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ í†µí•´ ë³´í˜¸ 
- í…ŒìŠ¤íŠ¸ ì½”ë“œ ìì²´ê°€ ê¸°ëŠ¥ ëª…ì„¸ì„œ

`SUT` : í…ŒìŠ¤íŠ¸ í•˜ëŠ” ëŒ€ìƒì´ì ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í•˜ë‚˜ì˜ ë‹¨ìœ„

ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì‹œ ë…ë¦½ì„ ìœ„í•˜ì—¬ ì˜ì¡´ ê´€ê³„ì˜ ê°ì²´ëŠ” í…ŒìŠ¤íŠ¸ë”ë¸”ë¡œ ëŒ€ì²˜í•˜ì—¬ ì „ë‹¬í•œë‹¤.



### í…ŒìŠ¤íŠ¸ ë”ë¸” 

> ì˜ì¡´ êµ¬ì„±ìš”ì†Œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì„ ë•Œ í…ŒìŠ¤íŠ¸ ëŒ€ìƒì½”ë“œì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ê°ì²´ ì¦‰,ê°€ì§œë¼ëŠ” ë§ì´ë‹¤.



## í†µí•© í…ŒìŠ¤íŠ¸ë€? 

> í…ŒìŠ¤íŠ¸ í•˜ê³ ì í•˜ëŠ” ì½”ë“œë¥¼ ë‹¤ë¥¸ ì˜ì¡´ê´€ê³„ë‚˜ ì™¸ë¶€ APIì™€ ì—°ë™ì´ ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-11 á„‹á…©á„’á…® 5.59.34](https://tva1.sinaimg.cn/large/e6c9d24egy1h15vzprzr8j21300tu40i.jpg)



## JUnit

- ë§¤ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì‹œë§ˆë‹¤ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ì–´ ë…ë¦½ì ì¸ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤. 
- ì–´ë…¸í…Œì´ì…˜ì„ ì œê³µí•´ì„œ í…ŒìŠ¤íŠ¸ ë¼ì´í”„ ì‚¬ì´í´ì„ ê´€ë¦¬í•˜ê²Œ í•´ì£¼ê³  í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ê°„ê²°í•˜ê²Œ ì‘ì„±í•˜ë„ë¡ ì§€ì›í•œë‹¤. 
- í…ŒìŠ¤íŠ¸ ëŸ¬ë„ˆë¥¼ ì œê³µí•´ì„œ ì¸í…”ë¦¬ì œì´, ì´í´ë¦½ìŠ¤, ë©”ì´ë¸ ë“±ì—ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‰½ê²Œ ì‹¤í–‰í•˜ê²Œ í•´ì¤€ë‹¤. 
- assertë¡œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì˜ ìˆ˜í–‰ ê²°ê³¼ë¥¼ íŒë³„í•˜ê²Œ í•´ì¤€ë‹¤. 
	- assertEquals(ì—ìƒ ê°’, ì‹¤ì œ ê°’)
- ê²°ê³¼ëŠ” ì„±ê³µ(ë…¹ìƒ‰), ì‹¤íŒ¨(ë¶‰ì€ìƒ‰) ì¤‘ í•˜ë‚˜ë¡œ í‘œì‹œí•œë‹¤.



JUnit4ì—ì„œëŠ” ë‹¨ì¼ jaríŒŒì¼ì´ì˜€ì§€ë§Œ Junit5ëŠ” ì•„ë˜ì™€ ê°™ì€ 3ê°œì˜ ëª¨ë“ˆì„ ê°€ì§€ê³  ìˆë‹¤. 

- JUnitPlatform
	- JVM ìƒì— í…ŒìŠ¤íŒ… í”„ë ˆì„ì›Œí¬ë¥¼ ëŸ°ì¹­í•˜ê¸° ìœ„í•œ ëŸ°ì²˜ë¥¼ ì œê³µí•œë‹¤. 
	- í…ŒìŠ¤íŠ¸ë¥¼ ë°œê²¬í•˜ê³  í…ŒìŠ¤íŠ¸ê³„íšì„ ìƒì„±í•˜ëŠ” TestEngine ì¸í„°í˜ì´ìŠ¤ë¥¼ ê°€ì§€ê³  ìˆê³  TestEngineì„ í†µí•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ë°œê²¬, ì‹¤í–‰, ê²°ê³¼ë¥¼ ë³´ê³ í•œë‹¤.
- JUnit Jupiter 
	- TestEngineì˜ ì‹¤ì œ êµ¬í˜„ì²´ëŠ” ë³„ë„ ëª¨ë“ˆì´ë©° ëª¨ë“ˆ ì¤‘ í•˜ë‚˜ê°€ jupiter-engineì´ë‹¤. 
	- ì´ ëª¨ë“ˆì€ jupiter-apië¥¼ ì‚¬ìš©í•´ì„œ ì‘ì„±í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë°œê²¬í•˜ê³  ì‹¤í–‰í•œë‹¤. 
	- Jupiter APIëŠ” JUnit5ì— ìƒˆë¡­ê²Œ ì¶”ê°€ëœ í…ŒìŠ¤íŠ¸ ì½”ë“œìš© APIë¡œì„œ, ê°œë°œìëŠ” í•´ë‹¹ APIë¥¼ ì‚¬ìš©í•´ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
- JUnit Vintage 
	- JUnit 4ë²„ì „ìœ¼ë¡œ ì‘ì„±í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•  ë•Œì—ëŠ” vintage-engine ëª¨ë“ˆì„ ì‚¬ìš©í•œë‹¤.



###  JUnit ì˜ˆì œ 

```java
class FixedAmountVoucherTest {

    private static final Logger logger = LoggerFactory.getLogger(FixedAmountVoucherTest.class);

    @BeforeAll
    static void setup() {
        logger.info("@BeforeAll - ë‹¨ í•œë²ˆ ì‹¤í–‰");
    }

    @BeforeEach
    void init() {
        logger.info("@BeforeEach - ë§¤ í…ŒìŠ¤íŠ¸ ë§ˆë‹¤ ì‹¤í–‰");
    }

    @Test
    @DisplayName("ê¸°ë³¸ì ì¸ assertEqual í…ŒìŠ¤íŠ¸ ğŸ‘")
    void testAssertEqual() {
        assertEquals(2, 1 + 1);
    }

    @Test
    @DisplayName("ì£¼ì–´ì§„ ê¸ˆì•¡ë§Œí¼ í• ì¸ì„ í•´ì•¼í•œë‹¤.")
    void testDiscount() {
        var sut = new FixedAmountVoucher(UUID.randomUUID(), 100);
        assertEquals(900, sut.discount(1000));
    }

    @Test
    @DisplayName("í• ì¸ëœ ê¸ˆì•¡ì€ ë§ˆì´ë„ˆìŠ¤ê°€ ë  ìˆ˜ ì—†ë‹¤.")
    void testMinDiscountedAmount() {
        var sut = new FixedAmountVoucher(UUID.randomUUID(), 1000);
        assertEquals(0, sut.discount(100));
    }

    @Test
    @DisplayName("í• ì¸ ê¸ˆì•¡ì€ ë§ˆì´ë„ˆìŠ¤ê°€ ë  ìˆ˜ ì—†ë‹¤.")
    void testWithMinus() {
        assertThrows(IllegalArgumentException.class, () -> new FixedAmountVoucher(UUID.randomUUID(), -100));
    }

    @Test
    @DisplayName("ìœ íš¨í•œ í• ì¸ ê¸ˆì•¡ìœ¼ë¡œë§Œ ìƒì„±í•  ìˆ˜ ìˆë‹¤.")
    void testVoucherCreation() {
        assertAll("FixedAmountVoucher creation",
            () -> assertThrows(IllegalArgumentException.class, () -> new FixedAmountVoucher(UUID.randomUUID(), 0)),
            () -> assertThrows(IllegalArgumentException.class, () -> new FixedAmountVoucher(UUID.randomUUID(), -100)),
            () -> assertThrows(IllegalArgumentException.class,
                () -> new FixedAmountVoucher(UUID.randomUUID(), 10000000))
        );
    }
}
```



### Hamcrest

```java
import static org.hamcrest.MatcherAssert.*;
import static org.hamcrest.Matchers.*;

public class HamcrestAssertionTest {

    @Test
    @DisplayName("ì—¬ëŸ¬ hamcrest matcher í…ŒìŠ¤íŠ¸")
    void hamcrestTest() {
        assertEquals(2, 1 + 1);
        assertThat(1 + 1, equalTo(2));
        assertThat(1 + 1, is(2));
        assertThat(1 + 1, anyOf(is(1), is(2)));

        assertNotEquals(1, 1 + 1);
        assertThat(1 + 1, not(equalTo(1)));
    }

    @Test
    @DisplayName("ì»¬ë ‰ì…˜ì— ëŒ€í•œ matcher í…ŒìŠ¤íŠ¸")
    void hamcrestListMatcherTest() {
        var prices = List.of(2, 3, 4);
        assertThat(prices, hasSize(3));
        assertThat(prices, everyItem(greaterThan(1)));
        assertThat(prices, containsInAnyOrder(3, 4, 2));
        assertThat(prices, hasItem(greaterThanOrEqualTo(2)));
    }
}
```



## Mock Object(ëª¨ì˜ ê°ì²´)

![2020 04 13 mocks and stubs](https://tva1.sinaimg.cn/large/e6c9d24egy1h15w943lbzj20dm072aa6.jpg)

[ì¶œì²˜](https://enterprisecraftsmanship.com/posts/when-to-mock/)

Mock ObjectëŠ” í–‰ìœ„ ê²€ì¦(behavior verification)ì„ ì‚¬ìš©í•˜ê³ , stubì„ í¬í•¨í•œ ë‹¤ë¥¸ ëŒ€ì—­ë“¤ì€ ìƒíƒœ ê²€ì¦(state verification)ì„ ì‚¬ìš©í•œë‹¤.

- ìƒíƒœ ê²€ì¦ : **ë©”ì„œë“œê°€ ìˆ˜í–‰ëœ í›„, ê°ì²´ì˜ ìƒíƒœë¥¼ í™•ì¸**í•˜ì—¬ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í–ˆëŠ”ì§€ë¥¼ í™•ì¸í•˜ëŠ” ê²€ì¦ë²• 
- í–‰ìœ„ ê²€ì¦ : ë©”ì„œë“œì˜ ë¦¬í„´ ê°’ìœ¼ë¡œ íŒë‹¨í•  ìˆ˜ ì—†ëŠ” ê²½ìš° **íŠ¹ì • ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ”ì§€** í™•ì¸í•˜ëŠ” ê²€ì¦ë²•



### Mock Object ìƒì„±ì„ ë„ì™€ì£¼ëŠ” Test Framework 

- Mockito
- JMock
- EasyMock 



### Stub ì˜ˆì œ 

```java
class OrderServiceTest {

    class OrderRepositoryStub implements OrderRepository {
        @Override
        public Order insert(Order order) {
            return null;
        }
    }

    @Test
    @DisplayName("ì˜¤ë”ê°€ ìƒì„±ë˜ì•¼í•œë‹¤. (stub)")
    void createOrderByStub() {
        // given
        var voucherRepository = new MemoryVoucherRepository();
        var fixedAmountVoucher = new FixedAmountVoucher(UUID.randomUUID(), 100);
        voucherRepository.insert(fixedAmountVoucher);
        var sut = new OrderService(new VoucherService(voucherRepository), new OrderRepositoryStub());

        // when
        var order = sut.createOrder(UUID.randomUUID(), List.of(new OrderItem(UUID.randomUUID(), 200, 1)),
            fixedAmountVoucher.getVoucherId());

        // then
        assertThat(order.totalAmount(), is(100L));
        assertThat(order.getVoucher().isEmpty(), is(false));
        assertThat(order.getVoucher().get().getVoucherId(), is(fixedAmountVoucher.getVoucherId()));
        assertThat(order.getOrderStatus(), is(OrderStatus.ACCEPTED));
    }
}
```

`OrderRepositoryStub`ì´ë¼ëŠ” ê°€ì§œ ê°ì²´ë¥¼ ë§Œë“¬ìœ¼ë¡œì¨ `order`ê°ì²´ì˜ ìƒíƒœë¥¼ í™•ì¸í•œë‹¤.



### Mock ì˜ˆì œ 

```java
import static org.mockito.Mockito.*;

class OrderServiceTest {

    @Test
    @DisplayName("ì˜¤ë”ê°€ ìƒì„±ë˜ì•¼í•œë‹¤. (mock)")
    void createOrderByMock() {
        // given
        var voucherServiceMock = mock(VoucherService.class);
        var orderRepositoryMock = mock(OrderRepository.class);
        var fixedAmountVoucher = new FixedAmountVoucher(UUID.randomUUID(), 100);
        when(voucherServiceMock.getVoucher(fixedAmountVoucher.getVoucherId())).thenReturn(fixedAmountVoucher);
        var sut = new OrderService(voucherServiceMock, orderRepositoryMock);

        // when
        var order = sut.createOrder(UUID.randomUUID(), List.of(new OrderItem(UUID.randomUUID(), 200, 1)),
            fixedAmountVoucher.getVoucherId());

        // then
        assertThat(order.totalAmount(), is(100L));
        assertThat(order.getVoucher().isEmpty(), is(false));
        var inOrder = inOrder(voucherServiceMock, orderRepositoryMock);
        inOrder.verify(voucherServiceMock).getVoucher(fixedAmountVoucher.getVoucherId());
        inOrder.verify(orderRepositoryMock).insert(order);
        inOrder.verify(voucherServiceMock).userVoucher(fixedAmountVoucher);
    }
}
```

`Mockito.mock()`ë©”ì„œë“œë¥¼ í†µí•´ `VoucherService`, `OrderRepository`ì„ Mockì‹œì¼œì¤€ë‹¤. 

`when()`ë©”ì„œë“œë¥¼ í†µí•´ Mockê°ì²´ì˜ ë©”ì„œë“œë¥¼ setupì„ ì‹œì¼œì¤€ë’¤  `verify()`ë©”ì„œë“œë¥¼ í†µí•´ ë©”ì„œë“œê°€ ì •ìƒì ìœ¼ë¡œ í˜¸ì¶œë˜ëŠ” ì§€ ê²€ì¦í•´ì¤€ë‹¤.

`Order`ì— ëŒ€í•œ ìƒíƒœê²€ì¦ë„ ê°€ëŠ¥í•˜ê³  Mockê°ì²´ì˜ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ëŠ” ì§€ë¥¼ ê²€ì¦í•œë‹¤. 

ì¶”ê°€ì ìœ¼ë¡œ `inOrder`ë¥¼ í†µí•´ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ì§€ í™•ì¸ë„ ê°€ëŠ¥í•˜ë‹¤.



## Springì˜ JUnit5 ì§€ì› 

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì§€ì› 

- Mock Objects ì§€ì› 
- General Testing Utilities
- Spring MVC Testing Utilities



### í†µí•© í…ŒìŠ¤íŠ¸ ì§€ì› 

- Spring TestContext í”„ë ˆì„ì›Œí¬ 
	- í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ IoC ì»¨í…Œì´ë„ˆë¥¼ ì œê³µí•´ì¤€ë‹¤.
	- ì‹¤ì œ ë¹ˆì„ í†µí•´ì„œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤.
- MockMvc 



### ì˜ˆì œ 

Spring TestContextëŠ” `@ContextConfiguration`ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 

```java
import org.springframework.test.context.ContextConfiguration;

@ContextConfiguration
public class KdtSpringContextTests {

    @Autowired
    ApplicationContext applicationContext;

    @Test
    @DisplayName("applicationContextê°€ ìƒì„± ë˜ì–´ì•¼ í•œë‹¤.")
    void testApplicationContext() {
        assertThat(applicationContext, notNullValue());
    }
}
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-11 á„‹á…©á„’á…® 6.22.35](https://tva1.sinaimg.cn/large/e6c9d24egy1h15wnluawjj21es0dq40o.jpg)

í•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸ì½”ë“œë¡œ í™•ì¸í•´ë³´ë©´ `ApplicationContext`ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í•œë‹¤.

ì‚¬ì‹¤ `@ContextConfiguration`ëŠ” `ApplicationContext`ê°€ ë§Œë“¤ì–´ì ¸ì•¼ í•˜ëŠ” ì§€ë§Œ ì•Œë ¤ì£¼ê³  ì‹¤ì§ˆì ìœ¼ë¡œ Junitê³¼ ìƒí˜¸ì‘ìš©í•˜ì—¬ TestContextê°€ ë§Œë“¤ì–´ì§€ëŠ” ê²ƒì€ SpringExtensionì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

`@ExtendWith(SpringExtension.class)`ë¥¼ ì–´ë…¸í…Œì´ì…˜í•˜ë©´ ì‹¤ì œSpringTestContext í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.



```java
@ExtendWith(SpringExtension.class)
@ContextConfiguration
public class KdtSpringContextTests {

    @Autowired
    ApplicationContext applicationContext;

    @Test
    @DisplayName("applicationContextê°€ ìƒì„± ë˜ì–´ì•¼ í•œë‹¤.")
    void testApplicationContext() {
        assertThat(applicationContext, notNullValue());
    }

    @Test
    @DisplayName("VoucherRepositoryê°€ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.")
    void testVoucherRepositoryCreation() {
        var bean = applicationContext.getBean(VoucherRepository.class);
        assertThat(bean, notNullValue());
    }
}
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-11 á„‹á…©á„’á…® 6.32.03](https://tva1.sinaimg.cn/large/e6c9d24egy1h15wxi4ppuj225k07sq77.jpg)

`ApplicationContext`ë¥¼ ê°€ì ¸ì˜¤ê¸´ í•˜ì§€ë§Œ `VoucherRepository`ê°€ ë¹ˆìœ¼ë¡œ ë“±ë¡ì´ ë˜ì§€ ì•Šì•˜ë‹¤. 



ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì£¼ê¸° ìœ„í•´`@ContextConfiguration`ì˜µì…˜ìœ¼ë¡œ Configurationì„ ë“±ë¡í•´ì£¼ë©´ ë¹ˆì´ ë“±ë¡ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. 

```java
@ExtendWith(SpringExtension.class)
@ContextConfiguration(classes = {AppConfiguration.class})
public class KdtSpringContextTests {
    ... // ë™ì¼
}
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-11 á„‹á…©á„’á…® 6.34.34](https://tva1.sinaimg.cn/large/e6c9d24egy1h15x025ikvj20kw06cgm6.jpg)



ìƒì„±í•œ Configurationì„ ì“°ëŠ” ê²ƒë³´ë‹¨ profileì´ë‚˜ ë³„ë„ì˜ ì„¤ì •ì´ í•„ìš”í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ Configurationí´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤. í…ŒìŠ¤íŠ¸ íŒ¨í‚¤ì§€ ë°‘ì— ë§Œë“¤ë˜ê°€ static classë¥¼ í†µí•´ ì •ì˜í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.  

static classë¡œ ì„¤ì • ì‹œ ì˜µì…˜ì„ ì£¼ì§€ ì•Šì•„ë„ ìë™ìœ¼ë¡œ ì°¾ì•„ ì„¤ì •í•´ì¤€ë‹¤.

```java
@SpringJUnitConfig
public class KdtSpringContextTests {

    @Configuration
    static class Config {
        @Bean
        VoucherRepository voucherRepository() {
            return new VoucherRepository() {
                @Override
                public Optional<Voucher> findById(UUID voucherId) {
                    return Optional.empty();
                }

                @Override
                public Voucher insert(Voucher voucher) {
                    return null;
                }
            };
        }
    }

    @Autowired
    ApplicationContext applicationContext;

    @Test
    @DisplayName("applicationContextê°€ ìƒì„± ë˜ì–´ì•¼ í•œë‹¤.")
    void testApplicationContext() {
        assertThat(applicationContext, notNullValue());
    }

    @Test
    @DisplayName("VoucherRepositoryê°€ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.")
    void testVoucherRepositoryCreation() {
        var bean = applicationContext.getBean(VoucherRepository.class);
        assertThat(bean, notNullValue());
    }
}
```

ìŠ¤í”„ë§ì€ `@ExtendWith({SpringExtension.class})`, `@ContextConfiguration` ë‘ ê°œì˜ ì–´ë…¸í…Œì´ì…˜ì„ í•©ì¹œ `@SpringJunitConfig`ë¥¼ ì œê³µí•´ì¤€ë‹¤.



### í†µí•© í…ŒìŠ¤íŠ¸ ì˜ˆì œ 

```java
@SpringJUnitConfig
@ActiveProfiles("test")
public class KdtSpringContextTests {

    @Configuration
    @ComponentScan(basePackages = {"org.prgrms.kdt.voucher", "org.prgrms.kdt.order", "org.prgrms.kdt.configuration"})
    static class Config {
    }


    @Autowired
    VoucherRepository voucherRepository;

    @Test
    @DisplayName("OrderServiceë¥¼ ì‚¬ìš©í•´ì„œ ì£¼ë¬¸ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤.")
    void testOrderService() {
        // given
        var fixedAmountVoucher = new FixedAmountVoucher(UUID.randomUUID(), 100);
        voucherRepository.insert(fixedAmountVoucher);

        // when
        var order = orderService.createOrder(UUID.randomUUID(), List.of(new OrderItem(UUID.randomUUID(), 200, 1)),
            fixedAmountVoucher.getVoucherId());

        // then
        assertThat(order.totalAmount(), is(100L));
        assertThat(order.getVoucher().isEmpty(), is(false));
        assertThat(order.getVoucher().get().getVoucherId(), is(fixedAmountVoucher.getVoucherId()));
        assertThat(order.getOrderStatus(), is(OrderStatus.ACCEPTED));
    }
}
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-11 á„‹á…©á„’á…® 6.41.46](https://tva1.sinaimg.cn/large/e6c9d24egy1h15x7ljouoj20ki04sjro.jpg)

ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ í†µí•´ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

í”„ë¡œíŒŒì¼ ì ìš©ì€ `@ActiveProfiles`ì„ í†µí•´ í•  ìˆ˜ ìˆë‹¤.



## Reference

- [ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ vs í†µí•© í…ŒìŠ¤íŠ¸ vs ì¸ìˆ˜ í…ŒìŠ¤íŠ¸](https://tecoble.techcourse.co.kr/post/2021-05-25-unit-test-vs-integration-test-vs-acceptance-test/)

- [[tdd] ì¸ìˆ˜í…ŒìŠ¤íŠ¸, ë‹¨ìœ„í…ŒìŠ¤íŠ¸, í†µí•©í…ŒìŠ¤íŠ¸, ì „ êµ¬ê°„ í…ŒìŠ¤íŠ¸](https://joont92.github.io/tdd/ì¸ìˆ˜í…ŒìŠ¤íŠ¸-ë‹¨ìœ„í…ŒìŠ¤íŠ¸-í†µí•©í…ŒìŠ¤íŠ¸-ì „-êµ¬ê°„-í…ŒìŠ¤íŠ¸/)