# 데이터 베이스는 왜 필요한가? 

모든 서비스는 데이터를 만들어내고 그 데이터의 저장을 필요로 한다. 이런 데이터를 저장하는 곳이 바로 데이터베이스이다. 

### 관계형 데이터베이스 종류 

1. 프로덕션 관계형 데이터베이스 (RDBMS)

   - 어떤 서비스의 운영에 필요한 데이터를 저장하는 곳 

   - MySQL, PostgreSQL, ....

   - 빠른 처리속도가 중요하다. 

   - 데이터를 구조화된 테이블들의 집합으로 구성하고 관리한다. 

2. 데이터 웨어하우스 관계형 데이터베이스 

   - 회사 관련 데이터를 저장하고 분석함으로써 의사결정과 서비스 최적화에 사용 
   - BigQuery, Snowflake, Redshift, ..
   - 프로덕션과는 다르게 처리속도보단 구조화된 큰 데이터를 처리하는 것이 더 중요하다.



### 데이터 순환 구조 

프로덕션용 데이터베이스 -> 데이터 웨어하우스 -> 비지니스 인사이트 -> 제품 서비스 개선 ( 예를 들면 타켓팅, 추천 시스템 )



### 데이터 베이스 구조 

1. 관계형 데이터베이스 : 구조화된 데이터 
   - 프로덕션용 관계형 데이터베이스
   - 데이터 웨어하우스용 관계형 데이터베이스 
2. 비관계형 데이터베이스 : 비구조화 데이터도 다룸 ( 테이블 형식 X )
   - NoSQL 데이터베이스 
   - 프로덕션용 관계형 데이터베이스를 **보완**하기 위한 용도로 많이 사용됨.
     - Key/Value Storage : Redis, Memcache 
     - Document Store : MongoDB 
     - Wide Column Storage : Cassandra, HBase, DynamoDB 
     - Serach Engine : ElasticSearch



## 시스템 구조 

- 2 tier 
  - 클라이언트와 서버 두 개의 티어로 구성 
  - 클라이언트는 사용자가 사용하는 UI가 되며, 비즈니스 로직도 이곳에 위치한다. 
  - 서버단이 데이터베이스이다. 
- 3 tier 
  - 프리젠테이션 티어 : 프론트 엔드 
  - 애플리케이션 티어 : 백엔드 
  - 데이터 티어 : 백엔드 



## 관계형 데이터베이스 

### 관계형 데이터베이스란?

- 구조화된 데이터를 저장하고 질의할 수 있도록 해주는 스토리지 
- 테이블 형태로 데이터를 정의하고 저장한다. ( 컬럼(열)과 레코드(행) 가 존재)
- 관계형 데이터베이스를 조작하는 프로그래밍 언어가 SQL이다. 
  - 테이블 정의를 위한 DDL(Data Definition Language)
  - 테이블 데이터 조작,질의를 위한 DML(Data Manipulation Language)
    - 테이블에 레코드를 추가,수정,삭제 혹은 읽어들이기 위해 사용 



### 대표적 관계형 데이터베이스 

1. 프로덕션 데이터베이스 
   - OLTP(OnLine Transaction Processing)
     - 서비스에 발생하는 일을 처리하는 작업 
   - 빠른 속도
   - 서비스에 필요한 정보 저장 
2. 데이터 웨어하우스 
   - OLAP(OnLine Analytical Processing)
   - 처리 데이터 크기에 집중 
   - 데이터 분석 등을 위한 데이터 저장 
   - 보통 프로덕션 데이터베이스를 복사해서 데이터 웨어하우스에 저장한다. 
     - 프로덕션 데이터베이스에 접근 못하도록 막는 것이다. 
     - 그렇지 않으면 분석하기 위해 쿼리를 프로덕션 데이터베이스에 할 경우 속도가 저하될 수 있기 때문이다.



### 관계형 데이터베이스 구조 

관계형 데이터베이스는 2단계로 구성된다. 

**데이터베이스(스키마)**라는 폴더 밑으로 **테이블**들이 존재한다. 

- 스키마 
  - 테이블1
  - 테이블2

이런식으로 구성된다.



### 테이블의 구조 

- 테이블 스키마라고 부르기도 한다. 
- 테이블은 레코드들로 구성되어 있다. (행)
- 레코드는 하나 이상의 필드(칼럼)으로 구성된다. 
- 필드(칼럼)는 이름과 타입, 속성으로 구성된다. 
  - 여기서 속성이란 primary key같은 것을 말한다.



## SQL

- DDL
  - 테이블의 구조를 정의하는 언어 
- DML 
  - 테이블에 레코드를 추가,삭제,갱신 또는 읽어오는 질의 언어



### 단점 

- 구조화된 데이터만 다루는 데 최적화되어 있다. 
  - 정규표현식을 통해 비구조화된 데이터를 어느 정도 다루는 것은 가능하나 제약이 심하다. 
  - 많은 관계형 데이터베이스들이 플랫한 구조만 지원한다. (no nested like JSON)
    - 필드1 
      - 필드2 
    - 이런식으로 **불가능!**! 



### Star schema

- 프로덕션 관계형 데이터베이스에서는 보통 스타 스키마를 사용한다. 
- 데이터를 논리적 단위로 나눠 저장하고 필요시 조인을 한다. 
- 스토리지의 낭비가 덜하고 업데이트가 쉽다 
  - 데이터가 반복되지 않으니깐 ! 
- **하지만 조인을 많이 해야해서 시간과 리소스를 잡아먹어 속도가 저하된다.**



### Denormalized schema 

- NoSQL이나 데이터 웨어하우스에서 사용하는 방식
  - 단위 테이블로 나눠 저장하지 않아 별도의 조인이 필요없다. 
  - 조인이 필요없다보니 빠른 계산이 가능
- 하지만 스토리지 낭비가 있고 변경시 일일이 다 바꿔야하는 단점이 존재한다. 
  - 데이터 웨어하우스는 클러스터 방식으로 저장해서 공간적인 제약이 덜하다. 



### SQL DDL 

- CREATE TABLE 

  ```sql
  CREATE TABLE raw_data.user_session_channel ( userid int,
                                              sessionid varchar(32) primary key,
  
                                              channel varchar(32) );
  ```

  - Primary key 속성을 지정할 수 있다. 

  - 성능향상을 위헤 인덱스를 지정할 수 있다. 
  - 컬러 이름/타입/속성(여러개 가능) 형식이다.

  

- DROP TABLE 

  - DROP TABLE table_name; 
  - 없는 테이블을 지우려고 하는 경우 에러! 
    - DROP TABLE **IF EXISTS** table_name;
  - DELETE FROM은 조건에 맞는 레코들을 지우는 DML이다. 

  

- ALTER TABLE : 테이블 수정

  - ALTER TABLE 테이블이름 ADD COLUMN 필드이름 필드타입;
    -  새로운 칼럼 추가 
  - ALTER TABLE 테이블이름 RENAME 현재필드이름 to 새필드이름;
    - 기존 컬럼 이름 변경
  - ALTER TABLE 테이블이름 DROP COLUMN 필드이름;
    - 기존 컬럼 제거 
  - ALTER TABLE 현재테이블이름 RENAME to 새테이블이름;
    - 테이블 이름 변경 



### SQL DML 

- SELECT 
  - SELECT FROM 
  - WHERE 
  - GROUP BY 
  - ORDER BY 
  - 보통 다수의 테이블의 조인해서 사용
- INSERT INTO : 레코드 추가 
- UPDATE FROM : 필드 값 수정 
- DELETE FROM : 레코드 삭제 
  - 모든 레코드 삭제도 가능하고 조건을 통해 선택하여 삭제 가능 
  - TRUNCATE는 조건을 정하지 못해 모든 레코드를 삭제한다.



